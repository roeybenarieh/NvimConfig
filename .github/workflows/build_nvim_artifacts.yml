name: artifact nvim generated folders
run-name: ${{ github.actor}} make artifact of nvim generated folders
on:
  workflow_dispatch:
  push:
    branches:
      - main
      - feat/cicd
jobs:
  artifact-neovim-generated-folders:
    runs-on: ubuntu-latest
    steps:
      # this checkout moves repo to the $GITHUB_WORKSPACE directory
      - name: checkout repo code to container
        uses: actions/checkout@v4
        
      - name: move nvim configuration from repo
        run: cd /home/runner/; mkdir -p .config/nvim; mv $GITHUB_WORKSPACE/* .config/nvim
        
        
      - name: install neovim
        uses: rhysd/action-setup-vim@v1
        with:
          neovim: true

      - name: install nvim plugins
        # open nvim without UI, call ":Lazy install" and quit
        run: nvim --headless -c "Lazy install" -c "qall"
          
      - name: compress nvim generated folders
        run: tar -czf build.tar.gz -C /home/runner/ .config/nvim/ .local/share/nvim
        
      - name: artifact nvim generated folders
        uses: actions/upload-artifact@v3
        with:
          name: generated nvim folders
          path: build.tar.gz
          retention-days: 90
      
